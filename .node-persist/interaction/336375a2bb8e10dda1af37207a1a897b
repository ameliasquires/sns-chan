{"key":"1247791231476568078","value":{"data":{"user_id":"1191416458727657565","settings":{"defaultColor":[43,45,49],"allowed-servers":["486957006628847626","545076257369358336"],"preloads":{"486957006628847626":{"753145819820982282":{"name":"admin-chan"},"748790869938929737":{"name":"logging"},"825023574221783102":{"name":"general"},"1200889277786116121":{"name":"staff-actions"}}}},"author":"579124982215344138","mess":{"channelId":"1200889277786116121","guildId":"486957006628847626","id":"1247791231476568078","createdTimestamp":1717567012424,"type":0,"system":false,"content":"","authorId":"762561860150362142","pinned":false,"tts":false,"nonce":null,"embeds":[{"type":"rich","title":"Ban Confirmed, Awaiting User Cleanup","thumbnail":{"width":128,"url":"https:\u002F\u002Fcdn.discordapp.com\u002Favatars\u002F1191416458727657565\u002Fa50415a6bc6a559a097f3169b83aa235.webp","proxy_url":"https:\u002F\u002Fimages-ext-1.discordapp.net\u002Fexternal\u002FxHCfe_OwNMwYKKXRYzQDWDKjxTzNmfm5zO3kxuUntHg\u002Fhttps\u002Fcdn.discordapp.com\u002Favatars\u002F1191416458727657565\u002Fa50415a6bc6a559a097f3169b83aa235.webp","height":128},"footer":{"text":"1\u002F1 confirmations"},"fields":[{"value":"\u003C@579124982215344138\u003E,\u003C@567337992122007552\u003E","name":"Confirmed by Staff:","inline":true},{"value":"\u003C@!1191416458727657565\u003E","name":"User:","inline":true},{"value":"Troll","name":"Ban Reason:","inline":false}],"content_scan_version":1,"color":2829617}],"components":[],"attachments":[],"stickers":[],"position":null,"roleSubscriptionData":null,"editedTimestamp":1717567018294,"mentions":{"everyone":false,"users":[],"roles":[],"crosspostedChannels":[],"repliedUser":null,"members":[],"channels":[]},"webhookId":null,"groupActivityApplicationId":null,"applicationId":null,"activity":null,"flags":0,"reference":null,"interaction":null,"cleanContent":""},"confirms":["579124982215344138","567337992122007552"],"param":{"send_loc":{"s":undefined,"e":undefined,"n":undefined,"d":undefined,"_":undefined,"l":undefined,"o":undefined,"c":undefined,"type":0,"guild":"486957006628847626","guildId":"486957006628847626","permissionOverwrites":["980379693435998258","814558111234654258","586781513471885323","486957006628847626","833027060665417769","555751551285723139"],"messages":["1247666991699988483","1247759213631897623","1247759709029535810","1247791231476568078"],"threads":[],"nsfw":false,"flags":0,"id":"1200889277786116121","name":"ðŸ“®staff-actions","rawPosition":2,"parentId":"486963918330396682","topic":null,"lastMessageId":"1247791230805606450","rateLimitPerUser":0,"createdTimestamp":1706384715268},"message":{"m":undefined,"e":undefined,"s":undefined,"a":undefined,"g":undefined,"type":2,"id":"1247791226124767302","applicationId":"762561860150362142","channelId":"1200889277786116121","guildId":"486957006628847626","user":"579124982215344138","member":"579124982215344138","version":1,"appPermissions":BigInt("2223201809976903"),"memberPermissions":BigInt("2249600789372737"),"locale":"en-US","guildLocale":"en-US","commandId":"1241268932170485802","commandName":"ban","commandType":1,"commandGuildId":"486957006628847626","deferred":false,"replied":true,"ephemeral":true,"webhook":{"id":"762561860150362142"},"options":{},"author":"579124982215344138"},"user":{"guildId":"486957006628847626","joinedTimestamp":1717565263138,"premiumSinceTimestamp":null,"nickname":"Floramora","pending":false,"communicationDisabledUntilTimestamp":1717570596097,"userId":"1191416458727657565","avatar":null,"flags":10,"displayName":"Floramora","roles":["820544781590462505","818194523083112509","803662918255640607","1051419794672455700","1126755158353793034","749218500463165511","486957006628847626"],"avatarURL":null,"displayAvatarURL":"https:\u002F\u002Fcdn.discordapp.com\u002Favatars\u002F1191416458727657565\u002Fa50415a6bc6a559a097f3169b83aa235.webp"},"reason":"Troll","details":null,"appeal":null,"thread":null},"embed":{"title":"Ban Confirmed","thumbnail":{"url":"https:\u002F\u002Fcdn.discordapp.com\u002Favatars\u002F1191416458727657565\u002Fa50415a6bc6a559a097f3169b83aa235.webp"},"footer":{"text":"1\u002F1 confirmations","icon_url":undefined},"color":2829617,"fields":[{"name":"Confirmed by Staff:","value":"\u003C@579124982215344138\u003E,\u003C@567337992122007552\u003E","inline":true},{"name":"User:","value":"\u003C@!1191416458727657565\u003E","inline":true},{"name":"Ban Reason:","value":"Troll"}]}},"fn":async function ban_btn_handle(data, interaction){
    EmbedBuilder = require("discord.js").EmbedBuilder
    data.mess = await interaction.channel.messages.fetch(data.mess.id)
    data.embed = new EmbedBuilder(data.embed)
    let client = interaction.client

    return new Promise(async (res, rej) => {
        interaction.deferUpdate();
        switch(interaction.customId){
            case "confirm":
                //if(data.confirms.includes(interaction.author.id))
                   // break
                data.confirms.push(interaction.author.id)
                let comb_mod = ""
                for(let mod of data.confirms){
                    comb_mod += "<@" + mod + ">"
                    if(mod != data.confirms[data.confirms.length-1]) comb_mod += ","
                }
                data.embed.setFooter({text:data.confirms.length - 1 + "/1 confirmations"})
                data.embed.data.fields[0].value = comb_mod

                if(data.confirms.length >= 2){
                    let ban_embed = new EmbedBuilder()
                        .setTitle("Banned from Supernoobs")
                        .setFooter({text:"You have been banned from this server. Maybe in another life, we could have been friends. But not in this one. ðŸ’”"})
                        .setColor(data.settings.defaultColor)
                        .setFields({name : "Reason", value : data.param.reason})
                    if(data.param.appeal) ban_embed.addFields({name : "Appeal id", value : "" + data.param.message.author.id})
                    let user = await client.users.cache.get(data.user_id);
                    let could_send = true
                    let could_ban = true
                    let could_del = true
                    data.embed.setTitle("Ban Confirmed, Awaiting User Cleanup");
                    data.mess.edit({embeds:[data.embed],components:[]})
                    try {
                        await user.send({embeds:[ban_embed]})
                    } catch (e) {
                        console.log(e)
                        could_send = false;
                    }
                    try{
                        user = interaction.guild.members.cache.get(user.id)
                        await user.ban({deleteMessageSeconds: 60 * 60 * 24 * 7, reason: data.param.reason})
                    } catch (e) {
                        console.log(e)
                        could_ban = false;
                    }
                    
                    data.embed.setTitle("Ban Confirmed" + (!could_send?" | Unable to Message":"") + (!could_ban?" | Unable to Ban":"") + (!could_del?" | Unable to Delete Msgs":""));
                    data.mess.edit({embeds:[data.embed],components:[]})
                } else {
                    data.mess.edit({embeds:[data.embed]})
                }
                break
            case "cancel":
                data.embed.setFooter({text:"canceled"})
                data.embed.setTitle("Ban Request Rejected")
                data.embed.addFields({name:"Removed By Staff:",value:"<@!"+data.author+">", inline : true})
                data.mess.edit({embeds:[data.embed],components:[]})
                break
        }
        res(data)
    })

  }},"ttl":undefined}